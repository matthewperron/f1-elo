# F1 ELO Project - Agent Instructions

## Project Overview

This is an F1 driver strength calculation project that computes ELO ratings for all Formula 1 drivers (historical and current) using the chess ELO algorithm.

## Key Concepts

### ELO System
- **Two separate ELO scores per driver**: Qualifying ELO and Race ELO
- **Teammate-only comparison**: Drivers are only compared against their teammates
- **Classic chess ELO formula**: Standard expected score and K-factor calculations
- **Chronological processing**: Race history must be sorted by date for accurate progression

### Data Requirements
- **Main data file**: `f1-historical-race-results.json` (generated by update script)
- **Data source**: Ergast API (https://api.jolpi.ca/ergast/f1/)
- **Data exclusions**: Skip races where no teammate participated or either driver had DNF
- **Required fields**: Driver names, teams, qualifying positions, race results, dates
- **Rate limiting**: 2 seconds between API calls to avoid hitting limits

### Output
- **README update**: ELO results table automatically inserted between `<!-- ELO_RESULTS_START -->` and `<!-- ELO_RESULTS_END -->` comments
- **Update script**: JavaScript/TypeScript script to recalculate and update README

## Project Structure

```
f1-elo/
├── data/
│   ├── 2024-race-results.json         # 2024 season race data and final ELOs
│   ├── 2023-race-results.json         # 2023 season race data and final ELOs
│   └── ...                            # Historical data (1950-2025)
├── main.js                            # Main orchestration script with ELO calculation
├── fetch-results.js                   # Data fetching from Ergast API
├── package.json                       # Node.js dependencies
└── README.md                          # Project documentation with results table
```

## Development Guidelines

### Data Processing
1. Parse race results from JSON file
2. Sort races chronologically by date
3. Group drivers by team for each race
4. Calculate ELO changes for qualifying and race separately
5. Exclude invalid comparisons (no teammate, DNF, etc.)

### ELO Calculation Rules
- **Initial rating**: All drivers start with 1000 ELO (or carry over from previous season)
- **Head-to-head only**: Compare qualifying/race positions between teammates
- **K-factor**: Determines rating change magnitude (32 for all drivers)
- **Expected score**: Based on ELO difference between teammates
- **Actual score**: 1 for win, 0 for loss in head-to-head comparison
- **Global ELO**: Combines qualifying (30%) and race (70%) performance

### Commands
- `npm start` - Calculate ELO for 2025 season data (default) and update README
- `npm run calculate -- YYYY` - Fetch specific season data and recalculate ratings
- `npm run elo-only` - Calculate ELO from existing data files (no fetching)
- `npm run elo-only -- YYYY` - Calculate ELO for specific year from existing data
- `npm run fetch-only -- YYYY` - Fetch specific season data only

## Implementation Notes

- Use JavaScript/TypeScript for the calculation script
- Ensure proper error handling for missing data
- Consider performance for large historical datasets
- Maintain separate tracking for qualifying vs race performance
- Results should be sorted by ELO rating (highest first)
